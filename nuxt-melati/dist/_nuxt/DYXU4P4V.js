const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DmZChluK.js","./Cv6nvi5C.js","./entry.CLdJT17f.css","./CloudinaryUploader.B8ox4cJ-.css"])))=>i.map(i=>d[i]);
import{i as N,r as g,e as w,q as _,f as H,l as L,c as n,a as t,t as u,v as C,E as r,I as P,u as o,F as U,h as V,G as m,Q as M,R as v,b as z,o as d,z as O,B as W}from"#entry";import{u as Q}from"./yfo-yYjr.js";import{u as J}from"./Jqm9ZWvo.js";import{u as X}from"./Cxate6rl.js";const Y={class:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto"},Z={class:"p-4 sm:p-6"},ee={class:"flex justify-between items-center mb-4 sm:mb-6"},te={class:"text-lg sm:text-xl font-semibold"},se={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4"},le=["value"],oe=["disabled"],ae=["value"],re={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4"},ie=["value"],ne={class:"flex gap-2"},ue={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},de={class:"flex items-start justify-between gap-4"},me={class:"flex-1"},pe={class:"flex items-center gap-2 mb-3"},ge={key:0},be={key:1,class:"space-y-1"},xe={class:"text-xl font-bold text-blue-600"},fe={class:"text-xs text-gray-500"},ce={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ve={class:"space-y-3"},ye={class:"flex flex-col xs:flex-row gap-3 xs:gap-6"},ke={class:"flex items-center"},we={class:"flex items-center"},_e={class:"flex items-center"},Pe={class:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-4"},Ue=["disabled"],Me=N({__name:"CatalogProductModal",props:{product:{},categories:{},subcategories:{}},emits:["close","saved"],setup($,{emit:G}){const K=O(()=>W(()=>import("./DmZChluK.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),i=$,j=G,{createProduct:E,updateProduct:F}=Q(),{getGoldPrices:I,calculatePrice:h}=J(),y=X(),f=g(!1),b=g(""),p=g([]),x=g([]),c=g(!1),s=g({category_id:"",subcategory_id:"",title:"",description:"",price:0,karat:"",weight:"",weight_grams:0,price_override:!1,thumbnail_image:"",images:[],specs:[],is_featured:!1,is_best_seller:!1,is_active:!0,stock_status:"available",display_order:0,custom_shopee_link:"",custom_whatsapp_number:""}),R=w(()=>s.value.category_id?i.subcategories.filter(a=>a.category_id===s.value.category_id):[]),S=w(()=>!s.value.weight_grams||!s.value.karat?0:h(s.value.weight_grams,s.value.karat,x.value)),T=w(()=>{const a=x.value.find(e=>e.karat===s.value.karat);return a?k(a.price_per_gram):"-"}),q=async()=>{const a=await I();a.success&&(x.value=a.data)},k=a=>a?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(a):"Rp 0";_(()=>s.value.weight_grams,a=>{a&&(s.value.weight=`${a} gram`)}),_([()=>s.value.weight_grams,()=>s.value.karat],()=>{!c.value&&!s.value.price_override&&(s.value.price=S.value)});const B=()=>{s.value.subcategory_id=""};H(async()=>{if(c.value=!0,await q(),i.product){if(s.value={...i.product},b.value=(i.product.specs||[]).join(`
`),i.product.images&&i.product.images.length>0?p.value=[...i.product.images]:i.product.thumbnail_image&&(p.value=[i.product.thumbnail_image]),!s.value.weight_grams&&s.value.weight){const e=s.value.weight.match(/[\d.]+/);e&&(s.value.weight_grams=parseFloat(e[0]))}await L();const a=h(s.value.weight_grams||0,s.value.karat||"",x.value);s.value.price!==a&&s.value.price>0&&(s.value.price_override=!0)}c.value=!1}),_(b,a=>{c.value||(s.value.specs=a.split(`
`).filter(e=>e.trim()))});const D=a=>{p.value=a,s.value.images=a,a.length>0?s.value.thumbnail_image=a[0]:s.value.thumbnail_image=""},A=async()=>{f.value=!0;try{const a=i.product?await F(i.product.id,s.value):await E(s.value);a.success?(y.success(i.product?`Produk "${s.value.title}" berhasil diupdate!`:`Produk "${s.value.title}" berhasil ditambahkan!`,4e3),j("saved")):y.error(`Gagal menyimpan produk: ${a.error||"Terjadi kesalahan"}`,5e3)}catch(a){console.error("Save error:",a),y.error("Terjadi kesalahan saat menyimpan produk. Silakan coba lagi.",5e3)}finally{f.value=!1}};return(a,e)=>(d(),n("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",onClick:e[18]||(e[18]=C(l=>a.$emit("close"),["self"]))},[t("div",Y,[t("div",Z,[t("div",ee,[t("h2",te,u(a.product?"Edit":"Tambah")+" Produk",1),t("button",{onClick:e[0]||(e[0]=l=>a.$emit("close")),class:"text-gray-500 hover:text-gray-700"},[...e[19]||(e[19]=[t("i",{class:"bi bi-x-lg text-lg sm:text-xl"},null,-1)])])]),t("form",{onSubmit:C(A,["prevent"]),class:"space-y-3 sm:space-y-4"},[t("div",se,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Kategori *",-1)),r(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>o(s).category_id=l),required:"",onChange:B,class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"},[e[20]||(e[20]=t("option",{value:""},"Pilih Kategori",-1)),(d(!0),n(U,null,V(a.categories,l=>(d(),n("option",{key:l.id,value:l.id},u(l.name),9,le))),128))],544),[[P,o(s).category_id]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Subkategori *",-1)),r(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o(s).subcategory_id=l),required:"",disabled:!o(s).category_id,class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"},[e[22]||(e[22]=t("option",{value:""},"Pilih Subkategori",-1)),(d(!0),n(U,null,V(o(R),l=>(d(),n("option",{key:l.id,value:l.id},u(l.name),9,ae))),128))],8,oe),[[P,o(s).subcategory_id]])])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Nama Produk *",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>o(s).title=l),type:"text",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Contoh: Kalung Fashion Elegan 18K"},null,512),[[m,o(s).title]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Deskripsi",-1)),r(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>o(s).description=l),rows:"3",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Product description..."},null,512),[[m,o(s).description]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Spesifikasi (satu per baris)",-1)),r(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=l=>M(b)?b.value=l:null),rows:"3",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:`Emas 18K
Berat: 4.5 gram
Panjang: 45cm`},null,512),[[m,o(b)]])]),t("div",re,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Kadar Emas *",-1)),r(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>o(s).karat=l),required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"},[e[27]||(e[27]=t("option",{value:""},"Pilih Kadar",-1)),(d(!0),n(U,null,V(o(x),l=>(d(),n("option",{key:l.karat,value:l.karat},u(l.karat)+" ("+u(k(l.price_per_gram))+"/gram) ",9,ie))),128))],512),[[P,o(s).karat]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Berat *",-1)),t("div",ne,[r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o(s).weight_grams=l),type:"number",step:"0.1",min:"0",required:"",class:"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"4.5"},null,512),[[m,o(s).weight_grams,void 0,{number:!0}]]),e[29]||(e[29]=t("span",{class:"self-center text-sm text-gray-600 whitespace-nowrap"},"gram",-1))])])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Harga (Rp) *",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>o(s).price=l),type:"number",step:"1000",min:"0",required:"",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"3500000"},null,512),[[m,o(s).price,void 0,{number:!0}]]),e[32]||(e[32]=t("p",{class:"text-xs text-gray-500 mt-1"},"Masukkan harga dalam Rupiah (tanpa titik/koma).",-1))]),t("div",ue,[t("div",de,[t("div",me,[t("label",pe,[r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o(s).price_override=l),type:"checkbox",class:"rounded"},null,512),[[v,o(s).price_override]]),e[33]||(e[33]=t("span",{class:"text-sm font-medium text-gray-900"},"Override Harga Manual",-1))]),o(s).price_override?(d(),n("div",ge,[e[34]||(e[34]=t("label",{class:"block text-xs font-medium text-gray-700 mb-2"},"Harga Custom (Rp)",-1)),r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>o(s).price=l),type:"number",step:"1000",min:"0",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"3500000"},null,512),[[m,o(s).price,void 0,{number:!0}]]),e[35]||(e[35]=t("p",{class:"text-xs text-yellow-600 mt-2"},"âš ï¸ Harga ini tidak akan berubah saat harga emas update",-1))])):(d(),n("div",be,[e[36]||(e[36]=t("p",{class:"text-xs text-gray-600"},"Harga Otomatis:",-1)),t("p",xe,u(k(o(S))),1),t("p",fe,u(o(s).weight_grams||0)+" gram Ã— "+u(o(T)),1)]))])])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-xs sm:text-sm font-medium mb-2"},"Gambar Produk",-1)),e[38]||(e[38]=t("p",{class:"text-xs text-gray-500 mb-2 sm:mb-3"}," Gambar pertama akan digunakan sebagai thumbnail. Anda dapat mengupload beberapa gambar untuk galeri. ",-1)),z(o(K),{modelValue:o(p),"onUpdate:modelValue":e[11]||(e[11]=l=>M(p)?p.value=l:null),onUploaded:D,folder:"products",single:!1,maxFiles:8,maxSize:5,showUrls:!1},null,8,["modelValue"])]),t("div",ce,[e[43]||(e[43]=t("h4",{class:"text-sm font-semibold mb-3 text-gray-900"},"ðŸ”— Link Custom (Opsional)",-1)),e[44]||(e[44]=t("p",{class:"text-xs text-gray-500 mb-3"}," Kosongkan untuk menggunakan link default berdasarkan kadar. Isi hanya jika produk ini perlu link khusus. ",-1)),t("div",ve,[t("div",null,[e[39]||(e[39]=t("label",{class:"block text-xs font-medium mb-2"},"Link Shopee Produk Spesifik",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>o(s).custom_shopee_link=l),type:"url",placeholder:"https://shopee.co.id/Produk-Spesifik-i.123.456",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"},null,512),[[m,o(s).custom_shopee_link]]),e[40]||(e[40]=t("p",{class:"text-xs text-gray-400 mt-1"},"Link langsung ke produk ini di Shopee",-1))]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-xs font-medium mb-2"},"Nomor WhatsApp Khusus",-1)),r(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>o(s).custom_whatsapp_number=l),type:"text",placeholder:"6281234567890",class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"},null,512),[[m,o(s).custom_whatsapp_number]]),e[42]||(e[42]=t("p",{class:"text-xs text-gray-400 mt-1"},"Nomor WA khusus untuk produk ini (format: 62xxx)",-1))])])]),t("div",ye,[t("label",ke,[r(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>o(s).is_featured=l),type:"checkbox",class:"mr-2"},null,512),[[v,o(s).is_featured]]),e[45]||(e[45]=t("span",{class:"text-xs sm:text-sm"},"Featured Product",-1))]),t("label",we,[r(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>o(s).is_best_seller=l),type:"checkbox",class:"mr-2"},null,512),[[v,o(s).is_best_seller]]),e[46]||(e[46]=t("span",{class:"text-xs sm:text-sm"},"Best Seller",-1))]),t("label",_e,[r(t("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>o(s).is_active=l),type:"checkbox",class:"mr-2"},null,512),[[v,o(s).is_active]]),e[47]||(e[47]=t("span",{class:"text-xs sm:text-sm"},"Active",-1))])]),t("div",Pe,[t("button",{type:"submit",disabled:o(f),class:"w-full sm:flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 px-4 rounded-lg font-medium disabled:opacity-50 text-sm sm:text-base"},u(o(f)?"Menyimpan...":"Simpan Produk"),9,Ue),t("button",{type:"button",onClick:e[17]||(e[17]=l=>a.$emit("close")),class:"w-full sm:flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium text-sm sm:text-base"}," Cancel ")])],32)])])]))}});export{Me as _};
