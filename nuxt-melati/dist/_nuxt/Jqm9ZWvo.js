import{m as l}from"#entry";const m=()=>{const{$supabase:c}=l();if(!c)throw new Error("Supabase client not available");const o=async()=>{const{data:e,error:r}=await c.from("gold_price_settings").select("*").eq("is_active",!0).order("karat");return{success:!r,data:e||[],error:r?.message}},u=async(e,r=50)=>{let t=c.from("gold_price_history").select("*, admin_users!changed_by(full_name)").order("changed_at",{ascending:!1}).limit(r);e&&(t=t.eq("karat",e));const{data:a,error:s}=await t;return{success:!s,data:a||[],error:s?.message}},d=async(e,r,t)=>{const{error:a}=await c.from("gold_price_settings").update({price_per_gram:r,updated_at:new Date().toISOString(),updated_by:t}).eq("karat",e);return{success:!a,error:a?.message}},n=(e,r,t)=>{const a=t.find(s=>s.karat===r);return!a||!e?0:Math.round(e*a.price_per_gram)};return{getGoldPrices:o,getPriceHistory:u,updateGoldPrice:d,calculatePrice:n,recalculateAllPrices:async()=>{try{const e=await o();if(!e.success)throw new Error("Failed to fetch gold prices");const{data:r,error:t}=await c.from("catalog_products").select("id, karat, weight_grams").eq("price_override",!1).not("weight_grams","is",null);if(t)throw new Error(t.message);const a=r?.map(s=>{const i=n(s.weight_grams,s.karat,e.data);return c.from("catalog_products").update({price:i,base_price:i,updated_at:new Date().toISOString()}).eq("id",s.id)});return await Promise.all(a||[]),{success:!0,count:r?.length||0}}catch(e){return{success:!1,error:e.message}}},getAffectedProductsCount:async e=>{const{count:r,error:t}=await c.from("catalog_products").select("*",{count:"exact",head:!0}).eq("karat",e).eq("price_override",!1).not("weight_grams","is",null);return{success:!t,count:r||0,error:t?.message}}}};export{m as u};
