import{i as S,r as i,q as j,f as L,c as o,o as n,a as t,u as l,d as v,t as r,F as w,h as k,j as P,E as M,G as V,n as A}from"#entry";import{u as F}from"./Jqm9ZWvo.js";const I={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-3"},N={key:0,class:"text-center py-12"},T={key:1,class:"space-y-4"},U={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"},E={class:"flex-1"},O={class:"font-semibold text-lg"},q={class:"text-xs text-gray-400 mt-1"},z={class:"flex items-center gap-3 w-full sm:w-auto"},K={class:"flex-1 sm:flex-none"},W=["onUpdate:modelValue"],J=["onClick","disabled"],Q={key:0,class:"mt-2 text-xs text-gray-400"},X={class:"border-t pt-6 mt-6"},Y={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Z=["disabled"],tt={key:2,class:"space-y-4"},et={class:"border rounded-lg overflow-hidden"},at={class:"min-w-full divide-y divide-gray-200"},st={class:"bg-white divide-y divide-gray-200"},rt={class:"px-4 py-3 text-sm font-medium text-gray-900"},lt={class:"px-4 py-3 text-sm text-gray-600"},ot={class:"px-4 py-3 text-sm text-gray-900 font-medium"},nt={class:"px-4 py-3 text-sm"},it={class:"px-4 py-3 text-sm text-gray-600"},dt={class:"px-4 py-3 text-sm text-gray-600"},ut={key:0,class:"text-center py-8 text-gray-500"},gt=S({__name:"GoldPriceManager",setup(ct){const{getGoldPrices:H,updateGoldPrice:C,recalculateAllPrices:D,getAffectedProductsCount:G,getPriceHistory:$}=F(),b=i([]),p=i([]),g=i({}),x=i(!0),u=i(null),c=i(!1),d=i(!1),y=async()=>{x.value=!0;const s=await H();if(s.success){b.value=s.data;for(const e of s.data){const a=await G(e.karat);a.success&&(g.value[e.karat]=a.count)}}x.value=!1},_=async()=>{const s=await $();s.success&&(p.value=s.data)},B=async s=>{if(!confirm(`Update harga ${s.karat} menjadi Rp ${s.price_per_gram.toLocaleString()}/gram?`))return;u.value=s.karat;const e=await C(s.karat,s.price_per_gram);e.success?(alert(`Harga ${s.karat} berhasil diupdate!`),await y(),await _()):alert("Gagal update harga: "+e.error),u.value=null},R=async()=>{const s=Object.values(g.value).reduce((a,m)=>a+m,0);if(!confirm(`Recalculate harga untuk ${s} produk?`))return;c.value=!0;const e=await D();e.success?(alert(`Berhasil recalculate ${e.count} produk!`),await y()):alert("Gagal recalculate: "+e.error),c.value=!1},f=s=>s?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(s):"-",h=s=>new Date(s).toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return j(d,s=>{s&&_()}),L(()=>{y()}),(s,e)=>(n(),o("div",null,[t("div",I,[e[2]||(e[2]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-900"},"Pengaturan Harga Emas"),t("p",{class:"text-sm text-gray-600 mt-1"},"Update harga per gram untuk setiap kadar emas")],-1)),t("button",{onClick:e[0]||(e[0]=a=>d.value=!l(d)),class:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors text-sm"},[e[1]||(e[1]=t("i",{class:"bi bi-clock-history mr-2"},null,-1)),v(" "+r(l(d)?"Tutup History":"Lihat History"),1)])]),l(x)?(n(),o("div",N,[...e[3]||(e[3]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-600"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Memuat data...",-1)])])):l(d)?(n(),o("div",tt,[t("div",et,[t("table",at,[e[9]||(e[9]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Kadar"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Harga Lama"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Harga Baru"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Perubahan"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Waktu"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Oleh")])],-1)),t("tbody",st,[(n(!0),o(w,null,k(l(p),a=>(n(),o("tr",{key:a.id,class:"hover:bg-gray-50"},[t("td",rt,r(a.karat),1),t("td",lt,r(f(a.old_price)),1),t("td",ot,r(f(a.new_price)),1),t("td",nt,[t("span",{class:A(["px-2 py-1 rounded-full text-xs font-medium",a.new_price>a.old_price?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},r(a.new_price>a.old_price?"+":"")+" "+r(f(a.new_price-a.old_price)),3)]),t("td",it,r(h(a.changed_at)),1),t("td",dt,r(a.admin_users?.full_name||"-"),1)]))),128))])]),l(p).length===0?(n(),o("div",ut,[...e[10]||(e[10]=[t("i",{class:"bi bi-inbox text-3xl mb-2"},null,-1),t("p",null,"Belum ada riwayat perubahan harga",-1)])])):P("",!0)])])):(n(),o("div",T,[(n(!0),o(w,null,k(l(b),a=>(n(),o("div",{key:a.id,class:"border rounded-lg p-4 hover:shadow-md transition-shadow"},[t("div",U,[t("div",E,[t("h3",O,r(a.karat),1),e[4]||(e[4]=t("p",{class:"text-sm text-gray-500"},"Harga per gram",-1)),t("p",q,r(l(g)[a.karat]||0)+" produk akan terupdate otomatis ",1)]),t("div",z,[t("div",K,[M(t("input",{"onUpdate:modelValue":m=>a.price_per_gram=m,type:"number",step:"1000",min:"0",class:"w-full sm:w-40 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"},null,8,W),[[V,a.price_per_gram,void 0,{number:!0}]])]),e[5]||(e[5]=t("span",{class:"text-sm text-gray-600 whitespace-nowrap"},"/ gram",-1)),t("button",{onClick:m=>B(a),disabled:l(u)===a.karat,class:"px-2 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors disabled:opacity-50 text-sm whitespace-nowrap"},r(l(u)===a.karat?"...":"Simpan"),9,J)])]),a.updated_at?(n(),o("div",Q," Terakhir update: "+r(h(a.updated_at)),1)):P("",!0)]))),128)),t("div",X,[t("div",Y,[e[7]||(e[7]=t("h3",{class:"font-semibold text-gray-900 mb-2"},"Recalculate Semua Harga Produk",-1)),e[8]||(e[8]=t("p",{class:"text-sm text-gray-600 mb-4"}," Akan mengupdate harga semua produk yang tidak di-override manual berdasarkan harga emas terbaru. ",-1)),t("button",{onClick:R,disabled:l(c),class:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors disabled:opacity-50"},[e[6]||(e[6]=t("i",{class:"bi bi-calculator mr-2"},null,-1)),v(" "+r(l(c)?"Menghitung ulang...":"Recalculate Semua"),1)],8,Z)])])]))]))}});export{gt as default};
