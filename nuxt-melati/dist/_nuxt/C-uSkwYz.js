import{r as m,m as h,C as v,f as _,D as w,c as f,a as e,v as S,j as I,E as x,G as k,u as r,H as L,n as D,t as A,d as G,o as p}from"#entry";import{u as M}from"./CmwV7s-5.js";const T=""+new URL("logo.vGupoTqU.png",import.meta.url).href,U=()=>{const c=m(!1),o=m(null),{$supabase:l}=h(),n=()=>{{const u=localStorage.getItem("isLoggedIn"),d=localStorage.getItem("loginTime"),t=localStorage.getItem("user");if(u==="true"&&d&&t){const a=Date.now(),y=parseInt(d);return a-y<864e5?(c.value=!0,o.value=JSON.parse(t),!0):(g(),!1)}}return!1},i=async(u,d)=>{try{if(!l)return{success:!1,message:"Database connection not available"};const{data:t,error:s}=await l.from("admin_users").select("id, username, full_name, email, role, is_active").eq("username",u).eq("is_active",!0).single();if(s||!t)return{success:!1,message:"Invalid username or password"};const{data:a,error:y}=await l.rpc("verify_admin_password",{p_username:u,p_password:d});if(!(y?!0:a))return{success:!1,message:"Invalid username or password"};await l.from("admin_users").update({last_login:new Date().toISOString()}).eq("id",t.id);{const b={id:t.id,username:t.username,full_name:t.full_name,role:t.role};localStorage.setItem("isLoggedIn","true"),localStorage.setItem("loginTime",Date.now().toString()),localStorage.setItem("user",JSON.stringify(b)),c.value=!0,o.value=b}return{success:!0,message:"Login successful"}}catch(t){return console.error("Login error:",t),{success:!1,message:"Login failed. Please try again."}}},g=()=>{localStorage.removeItem("isLoggedIn"),localStorage.removeItem("loginTime"),localStorage.removeItem("user"),c.value=!1,o.value=null};return n(),{isLoggedIn:v(c),user:v(o),login:i,logout:g,checkAuth:n}},V={class:"min-h-screen bg-gradient-to-br from-yellow-50 via-white to-yellow-100 flex items-center justify-center p-4 sm:p-6 lg:p-8"},q={class:"max-w-md w-full"},z={class:"bg-white rounded-2xl shadow-xl p-6 sm:p-8 border border-gray-100"},N={class:"relative"},E={class:"relative"},P=["type"],j={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3"},C={class:"flex"},B={class:"ml-2 text-sm text-red-600"},O=["disabled"],H={key:0,class:"flex items-center justify-center"},J={key:1},K={__name:"login",setup(c){M({title:"Login - Melati Gold Admin",meta:[{name:"description",content:"Admin login for Melati Gold Gallery"}],link:[{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"}]});const o=m({username:"",password:""}),l=m(!1),n=m(!1),i=m(""),{login:g,checkAuth:u}=U(),d=async()=>{n.value=!0,i.value="";try{const t=await g(o.value.username,o.value.password);t.success?await w("/dashboard"):i.value=t.message}catch(t){console.error("Login error:",t),i.value="An error occurred during login"}finally{n.value=!1}};return _(()=>{u()&&w("/dashboard")}),(t,s)=>(p(),f("div",V,[e("div",q,[s[9]||(s[9]=e("div",{class:"text-center mb-6 sm:mb-8"},[e("img",{src:T,alt:"Melati Gold Logo",class:"mx-auto w-20 h-20 md:w-20 md:h-20"}),e("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-800 mb-1 sm:mb-2"},"Melati Gold"),e("p",{class:"text-sm sm:text-base text-gray-600"},"Admin Dashboard")],-1)),e("div",z,[e("form",{onSubmit:S(d,["prevent"]),class:"space-y-5 sm:space-y-6"},[e("div",null,[s[4]||(s[4]=e("label",{for:"username",class:"block text-sm font-medium text-gray-700 mb-2"},"Username",-1)),e("div",N,[s[3]||(s[3]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("i",{class:"bi bi-person-fill text-gray-400",style:{"font-size":"1.25rem"}})],-1)),x(e("input",{id:"username","onUpdate:modelValue":s[0]||(s[0]=a=>r(o).username=a),type:"text",required:"",class:"block w-full pl-10 pr-3 py-3 sm:py-3 text-base sm:text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-colors",placeholder:"Enter your username"},null,512),[[k,r(o).username]])])]),e("div",null,[s[6]||(s[6]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-2"},"Password",-1)),e("div",E,[s[5]||(s[5]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("i",{class:"bi bi-lock-fill text-gray-400",style:{"font-size":"1.25rem"}})],-1)),x(e("input",{id:"password","onUpdate:modelValue":s[1]||(s[1]=a=>r(o).password=a),type:r(l)?"text":"password",required:"",class:"block w-full pl-10 pr-10 py-3 sm:py-3 text-base sm:text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-colors",placeholder:"Enter your password"},null,8,P),[[L,r(o).password]]),e("button",{type:"button",onClick:s[2]||(s[2]=a=>l.value=!r(l)),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[e("i",{class:D([r(l)?"bi bi-eye-slash-fill":"bi bi-eye-fill","text-gray-400"]),style:{"font-size":"1.25rem"}},null,2)])])]),r(i)?(p(),f("div",j,[e("div",C,[s[7]||(s[7]=e("i",{class:"bi bi-x-circle-fill text-red-400",style:{"font-size":"1.25rem"}},null,-1)),e("p",B,A(r(i)),1)])])):I("",!0),e("button",{type:"submit",disabled:r(n),class:"w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-white py-3 sm:py-3 px-4 rounded-lg hover:from-yellow-600 hover:to-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed text-base sm:text-sm"},[r(n)?(p(),f("span",H,[...s[8]||(s[8]=[e("i",{class:"bi bi-arrow-repeat animate-spin -ml-1 mr-3 text-white",style:{"font-size":"1.25rem"}},null,-1),G(" Signing in... ",-1)])])):(p(),f("span",J,"Sign In"))],8,O)],32)]),s[10]||(s[10]=e("div",{class:"text-center mt-6 sm:mt-8"},[e("p",{class:"text-xs sm:text-sm text-gray-500"},"Â© 2025 Melati Gold Gallery. All rights reserved.")],-1))])]))}};export{K as default};
