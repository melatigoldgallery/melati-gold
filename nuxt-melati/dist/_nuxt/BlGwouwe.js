import{m as V,r as d,e as N,f as $,c as u,a as e,j as v,d as k,u as a,n as m,t as o,F as B,h as G,v as T,E as b,G as w,I,o as c}from"#entry";import{u as L}from"./CmwV7s-5.js";const z={class:"min-h-screen bg-gray-50 py-6 sm:py-8"},H={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},F={class:"mb-6 sm:mb-8"},O={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},R={class:"flex items-center"},K={class:"bg-white rounded-xl shadow-sm overflow-hidden"},P={class:"overflow-x-auto"},J={class:"min-w-full divide-y divide-gray-200"},Q={class:"bg-white divide-y divide-gray-200"},W={class:"px-4 sm:px-6 py-4"},X={class:"flex items-center"},Y={class:"ml-4"},Z={class:"text-sm font-medium text-gray-900"},ee={class:"text-sm text-gray-500"},te={class:"px-4 sm:px-6 py-4"},se={class:"px-4 sm:px-6 py-4"},le={class:"px-4 sm:px-6 py-4 text-sm text-gray-500"},ae={class:"px-4 sm:px-6 py-4 text-right text-sm font-medium space-x-2"},re=["onClick"],oe=["onClick","title"],ie=["onClick","disabled"],ne={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},de={class:"bg-white rounded-xl max-w-md w-full p-6 sm:p-8"},ue={class:"flex items-center justify-between mb-6"},me={class:"text-xl font-bold text-gray-900"},ce=["disabled"],pe={key:0},xe={class:"flex gap-3 mt-6"},ge=["disabled"],be={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},fe={class:"bg-white rounded-xl max-w-md w-full p-6"},ye={class:"text-center"},ve={class:"text-sm text-gray-500 mb-6"},we={class:"flex gap-3"},Ue={__name:"users",setup(he){L({title:"Admin Users - Melati Gold",link:[{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"}]});const{$supabase:g}=V(),U=d([]),h=d(!1),i=d(null),p=d(null),f=d(!1),x=d({show:!1,type:"",message:""}),r=d({username:"",full_name:"",email:"",password:"",role:"admin"}),A=N(()=>x.value.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"),y=async()=>{try{const{data:s,error:t}=await g.from("admin_users").select("*").order("created_at",{ascending:!1});if(t)throw t;U.value=s||[]}catch(s){console.error("Error loading users:",s),n("error","Gagal memuat data users")}},D=async()=>{f.value=!0;try{if(i.value){const{error:s}=await g.from("admin_users").update({full_name:r.value.full_name,email:r.value.email,role:r.value.role,updated_at:new Date().toISOString()}).eq("id",i.value.id);if(s)throw s;n("success","User berhasil diupdate")}else{const{error:s}=await g.rpc("create_admin_user",{p_username:r.value.username,p_password:r.value.password,p_full_name:r.value.full_name,p_email:r.value.email,p_role:r.value.role});if(s)throw s;n("success","User berhasil ditambahkan")}_(),await y()}catch(s){console.error("Error saving user:",s),n("error",s.message||"Gagal menyimpan user")}finally{f.value=!1}},S=s=>{i.value=s,r.value={username:s.username,full_name:s.full_name,email:s.email,role:s.role,password:""}},E=async s=>{try{const{error:t}=await g.from("admin_users").update({is_active:!s.is_active,updated_at:new Date().toISOString()}).eq("id",s.id);if(t)throw t;n("success",`User berhasil ${s.is_active?"dinonaktifkan":"diaktifkan"}`),await y()}catch(t){console.error("Error toggling user status:",t),n("error","Gagal mengubah status user")}},M=s=>{p.value=s},j=async()=>{try{const{error:s}=await g.from("admin_users").delete().eq("id",p.value.id);if(s)throw s;n("success","User berhasil dihapus"),p.value=null,await y()}catch(s){console.error("Error deleting user:",s),n("error","Gagal menghapus user")}},_=()=>{h.value=!1,i.value=null,r.value={username:"",full_name:"",email:"",password:"",role:"admin"}},n=(s,t)=>{x.value={show:!0,type:s,message:t},setTimeout(()=>{x.value.show=!1},5e3)},q=s=>s?new Date(s).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";return $(()=>{y()}),(s,t)=>(c(),u("div",z,[e("div",H,[e("div",F,[e("div",O,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900"},"Admin Users"),e("p",{class:"mt-1 text-sm text-gray-600"},"Kelola akun admin yang bisa mengakses dashboard")],-1)),e("button",{onClick:t[0]||(t[0]=l=>h.value=!0),class:"inline-flex items-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"},[...t[7]||(t[7]=[e("i",{class:"bi bi-person-plus-fill mr-2"},null,-1),k(" Tambah Admin ",-1)])])])]),a(x).show?(c(),u("div",{key:0,class:m([a(A),"mb-6 rounded-lg p-4"])},[e("div",R,[e("i",{class:m([a(x).type==="success"?"bi-check-circle-fill":"bi-exclamation-circle-fill","text-lg mr-2"])},null,2),e("span",null,o(a(x).message),1)])],2)):v("",!0),e("div",K,[e("div",P,[e("table",J,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," User "),e("th",{class:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role "),e("th",{class:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{class:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Last Login "),e("th",{class:"px-4 sm:px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Q,[(c(!0),u(B,null,G(a(U),l=>(c(),u("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",W,[e("div",X,[t[9]||(t[9]=e("div",{class:"flex-shrink-0 h-10 w-10 bg-yellow-100 rounded-full flex items-center justify-center"},[e("i",{class:"bi bi-person-fill text-yellow-600 text-lg"})],-1)),e("div",Y,[e("div",Z,o(l.full_name),1),e("div",ee,"@"+o(l.username),1)])])]),e("td",te,[e("span",{class:m([l.role==="superadmin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","px-2 py-1 text-xs font-semibold rounded-full"])},o(l.role),3)]),e("td",se,[e("span",{class:m([l.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 text-xs font-semibold rounded-full"])},o(l.is_active?"Active":"Inactive"),3)]),e("td",le,o(q(l.last_login)),1),e("td",ae,[e("button",{onClick:C=>S(l),class:"text-blue-600 hover:text-blue-900",title:"Edit"},[...t[10]||(t[10]=[e("i",{class:"bi bi-pencil-fill"},null,-1)])],8,re),e("button",{onClick:C=>E(l),class:m(l.is_active?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"),title:l.is_active?"Deactivate":"Activate"},[e("i",{class:m(l.is_active?"bi-pause-circle-fill":"bi-play-circle-fill")},null,2)],10,oe),e("button",{onClick:C=>M(l),class:m(["text-red-600 hover:text-red-900",l.role==="superadmin"?"opacity-50 cursor-not-allowed":""]),title:"Delete",disabled:l.role==="superadmin"},[...t[11]||(t[11]=[e("i",{class:"bi bi-trash-fill"},null,-1)])],10,ie)])]))),128))])])])]),a(h)||a(i)?(c(),u("div",ne,[e("div",de,[e("div",ue,[e("h2",me,o(a(i)?"Edit Admin User":"Tambah Admin Baru"),1),e("button",{onClick:_,class:"text-gray-400 hover:text-gray-600"},[...t[13]||(t[13]=[e("i",{class:"bi bi-x-lg text-xl"},null,-1)])])]),e("form",{onSubmit:T(D,["prevent"]),class:"space-y-4"},[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Username",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>a(r).username=l),type:"text",required:"",disabled:!!a(i),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent disabled:bg-gray-100",placeholder:"Username"},null,8,ce),[[w,a(r).username]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nama Lengkap",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>a(r).full_name=l),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Nama lengkap"},null,512),[[w,a(r).full_name]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a(r).email=l),type:"email",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"email@example.com"},null,512),[[w,a(r).email]])]),a(i)?v("",!0):(c(),u("div",pe,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Password",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>a(r).password=l),type:"password",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent",placeholder:"Minimal 8 karakter"},null,512),[[w,a(r).password]])])),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Role",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a(r).role=l),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"},[...t[18]||(t[18]=[e("option",{value:"admin"},"Admin",-1),e("option",{value:"superadmin"},"Superadmin",-1)])],512),[[I,a(r).role]])]),e("div",xe,[e("button",{type:"button",onClick:_,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," Batal "),e("button",{type:"submit",disabled:a(f),class:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:opacity-50"},o(a(f)?"Menyimpan...":"Simpan"),9,ge)])],32)])])):v("",!0),a(p)?(c(),u("div",be,[e("div",fe,[e("div",ye,[t[22]||(t[22]=e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"},[e("i",{class:"bi bi-exclamation-triangle-fill text-red-600 text-xl"})],-1)),t[23]||(t[23]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Hapus Admin User",-1)),e("p",ve,[t[20]||(t[20]=k(" Apakah Anda yakin ingin menghapus user ",-1)),e("strong",null,o(a(p).username),1),t[21]||(t[21]=k(" ? Tindakan ini tidak dapat dibatalkan. ",-1))]),e("div",we,[e("button",{onClick:t[6]||(t[6]=l=>p.value=null),class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," Batal "),e("button",{onClick:j,class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"}," Hapus ")])])])])):v("",!0)])]))}};export{Ue as default};
