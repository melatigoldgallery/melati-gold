import{r as f,C as A,a6 as L,i as W,e as H,f as K,q as Q,c as u,o as c,a as l,j as b,u as n,t as k,k as X,n as Y,v as C,F as D,h as V,d as B,_ as Z}from"#entry";const ee=()=>{const $=L(),x=f(!1),i=async(o,s="general")=>{x.value=!0;try{const r=$.public.cloudinaryCloudName,y=$.public.cloudinaryUploadPreset;if(!r||!y)throw new Error("Cloudinary not configured");const a=new FormData;a.append("file",o),a.append("upload_preset",y),a.append("folder",`melati-gold/${s}`),a.append("public_id",`${s}_${Date.now()}`);const p=await fetch(`https://api.cloudinary.com/v1_1/${r}/image/upload`,{method:"POST",body:a}),d=await p.json();if(!p.ok)throw new Error(d.error?.message||"Upload failed");return{success:!0,data:{url:d.secure_url,publicId:d.public_id,width:d.width,height:d.height,format:d.format,bytes:d.bytes}}}catch(r){return console.error("Cloudinary upload error:",r),{success:!1,error:r.message||"Upload failed"}}finally{x.value=!1}},v=async o=>{try{return{success:!0,data:await $fetch("/api/cloudinary/delete",{method:"POST",body:{publicId:o}})}}catch(s){return console.error("Cloudinary delete error:",s),{success:!1,error:s.message||"Delete failed"}}},U=async()=>{try{return{success:!0,data:await $fetch("/api/cloudinary/usage")}}catch(o){return console.error("Cloudinary usage error:",o),{success:!1,error:o.message||"Failed to get usage"}}},w=(o,s)=>!o||!o.includes("cloudinary.com")?o:o.replace("/upload/",`/upload/${s}/`),F=(o,s={})=>{const r=[];return s.width&&r.push(`w_${s.width}`),s.height&&r.push(`h_${s.height}`),s.quality&&r.push(`q_${s.quality}`),s.format&&r.push(`f_${s.format}`),s.format||r.push("f_auto"),s.quality||r.push("q_auto"),w(o,r.join(","))};return{uploading:A(x),uploadFile:i,deleteFile:v,getUsage:U,transformImage:w,getOptimizedUrl:F}},te={class:"cloudinary-uploader"},le=["accept","multiple"],se={key:0,class:"space-y-3"},ae={class:"text-sm text-gray-600"},oe={class:"w-full bg-gray-200 rounded-full h-2"},re={key:1},ie={class:"text-sm font-medium text-gray-700"},ne={class:"text-xs text-gray-500 mt-1"},de={key:0,class:"text-xs text-gray-500"},ue={key:0,class:"mt-4 space-y-3"},ce={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"},pe=["src","alt"],ge={class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2"},me=["onClick"],ye=["onClick"],fe={key:0,class:"absolute top-2 left-2"},ve={key:0,class:"text-xs"},he={class:"mt-2 space-y-1"},be={class:"flex-1 bg-gray-100 px-2 py-1 rounded text-xs overflow-x-auto"},xe=["onClick"],we={key:1,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},_e={class:"text-sm text-red-600"},ke={class:"relative max-w-4xl w-full"},Ce=["src"],$e=W({__name:"CloudinaryUploader",props:{folder:{},single:{type:Boolean},maxFiles:{},maxSize:{},accept:{},showUrls:{type:Boolean},modelValue:{}},emits:["uploaded","update:modelValue","error"],setup($,{emit:x}){const i=$,v=x,{uploadFile:U}=ee(),w=(e,t,g,m="auto")=>{if(!e||!e.includes("cloudinary.com"))return e;const _=`w_${t},h_${g},c_fill,f_auto,q_${m}`;return e.replace("/upload/",`/upload/${_}/`)},F={thumbnail:e=>w(e,400,400,"auto"),detail:e=>w(e,1e3,1e3,90)},o=f(null),s=f(!1),r=f(!1),y=f(0),a=f([]),p=f(""),d=f(null),I=H(()=>`PNG, JPG, WebP up to ${i.maxSize||5}MB`),M=e=>!e||!e.includes("cloudinary.com")?e:F.thumbnail(e),N=e=>!e||!e.includes("cloudinary.com")?e:F.detail(e);K(()=>{i.modelValue&&i.modelValue.length>0&&(a.value=[...i.modelValue])}),Q(()=>i.modelValue,e=>{e&&JSON.stringify(e)!==JSON.stringify(a.value)&&(a.value=[...e])});const O=()=>{!r.value&&o.value&&o.value.click()},j=e=>{const t=e.target;t.files&&P(Array.from(t.files))},q=e=>{s.value=!1,e.dataTransfer?.files&&P(Array.from(e.dataTransfer.files))},P=async e=>{if(p.value="",i.single&&e.length>1){p.value="Only one file is allowed";return}if(i.maxFiles&&a.value.length+e.length>i.maxFiles){p.value=`Maximum ${i.maxFiles} files allowed`;return}const t=(i.maxSize||5)*1024*1024;if(e.filter(h=>h.size>t).length>0){p.value=`Some files exceed ${i.maxSize||5}MB limit`;return}const m=["image/jpeg","image/jpg","image/png","image/webp"];if(e.filter(h=>!m.includes(h.type)).length>0){p.value="Only JPG, PNG, and WebP images are allowed";return}r.value=!0,y.value=0;try{const h=e.map(async(J,R)=>{const z=await U(J,i.folder||"general");if(y.value=Math.round((R+1)/e.length*100),z.success&&z.data)return z.data.url;throw new Error(z.error||"Upload failed")}),S=await Promise.all(h);i.single?a.value=[S[0]]:a.value=[...a.value,...S],v("uploaded",a.value),v("update:modelValue",a.value),o.value&&(o.value.value="")}catch(h){p.value=h.message||"Upload failed",v("error",p.value)}finally{r.value=!1,y.value=0}},T=e=>{a.value.splice(e,1),v("uploaded",a.value),v("update:modelValue",a.value)},E=e=>{d.value=e},G=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){console.error("Failed to copy:",t)}};return(e,t)=>(c(),u("div",te,[l("div",{onDrop:C(q,["prevent"]),onDragover:t[0]||(t[0]=C(g=>s.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=C(g=>s.value=!1,["prevent"])),class:Y(["border-2 border-dashed rounded-lg p-6 text-center transition-colors",n(s)?"border-yellow-600 bg-yellow-50":"border-gray-300 hover:border-yellow-400",n(r)?"opacity-50 cursor-not-allowed":"cursor-pointer"]),onClick:O},[l("input",{ref_key:"fileInput",ref:o,type:"file",accept:e.accept,multiple:!e.single,onChange:j,class:"hidden"},null,40,le),n(r)?(c(),u("div",se,[t[4]||(t[4]=l("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-yellow-600"},null,-1)),l("p",ae,"Uploading "+k(n(y))+"%...",1),l("div",oe,[l("div",{class:"bg-yellow-600 h-2 rounded-full transition-all duration-300",style:X({width:n(y)+"%"})},null,4)])])):(c(),u("div",re,[t[5]||(t[5]=l("i",{class:"bi bi-cloud-upload text-4xl text-gray-400 mb-2"},null,-1)),l("p",ie,k(n(s)?"Drop files here":"Click to upload or drag & drop"),1),l("p",ne,k(n(I)),1),e.single?b("",!0):(c(),u("p",de,"Multiple files allowed"))]))],34),n(a).length>0?(c(),u("div",ue,[t[10]||(t[10]=l("h4",{class:"text-sm font-medium text-gray-700"},"Uploaded Images:",-1)),l("div",ce,[(c(!0),u(D,null,V(n(a),(g,m)=>(c(),u("div",{key:m,class:"relative group aspect-square bg-gray-100 rounded-lg overflow-hidden"},[l("img",{src:M(g),alt:`Preview ${m+1}`,class:"w-full h-full object-cover",loading:"lazy",decoding:"async"},null,8,pe),l("div",ge,[l("button",{type:"button",onClick:C(_=>E(g),["stop"]),class:"p-2 bg-white rounded-full hover:bg-gray-100 transition-colors",title:"View"},[...t[6]||(t[6]=[l("i",{class:"bi bi-eye text-gray-700"},null,-1)])],8,me),l("button",{type:"button",onClick:C(_=>T(m),["stop"]),class:"p-2 bg-white rounded-full hover:bg-red-50 transition-colors",title:"Remove"},[...t[7]||(t[7]=[l("i",{class:"bi bi-trash text-red-600"},null,-1)])],8,ye)]),m===0&&!e.single?(c(),u("div",fe,[...t[8]||(t[8]=[l("span",{class:"px-2 py-1 bg-yellow-600 text-white text-xs rounded-full"},"Primary",-1)])])):b("",!0)]))),128))]),e.showUrls?(c(),u("details",ve,[t[9]||(t[9]=l("summary",{class:"cursor-pointer text-gray-600 hover:text-gray-800"},"Show URLs",-1)),l("div",he,[(c(!0),u(D,null,V(n(a),(g,m)=>(c(),u("div",{key:m,class:"flex items-center gap-2"},[l("code",be,k(g),1),l("button",{type:"button",onClick:_=>G(g),class:"px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded text-xs"}," Copy ",8,xe)]))),128))])])):b("",!0)])):b("",!0),n(p)?(c(),u("div",we,[l("p",_e,[t[11]||(t[11]=l("i",{class:"bi bi-exclamation-triangle mr-1"},null,-1)),B(" "+k(n(p)),1)])])):b("",!0),n(d)?(c(),u("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-[60]",onClick:t[3]||(t[3]=g=>d.value=null)},[l("div",ke,[l("button",{onClick:t[2]||(t[2]=g=>d.value=null),class:"absolute -top-12 right-0 text-white hover:text-gray-300 text-xl"},[...t[12]||(t[12]=[l("i",{class:"bi bi-x-lg"},null,-1),B(" Close ",-1)])]),l("img",{src:N(n(d)),alt:"Full view",class:"w-full h-auto rounded-lg",loading:"lazy"},null,8,Ce)])])):b("",!0)]))}}),ze=Z($e,[["__scopeId","data-v-7557a7a0"]]);export{ze as default};
